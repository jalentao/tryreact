<!DOCTYPE html>
<html lang="zh-Hans-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="format-detection" content="telephone=no,email=no" />
    <!--#include virtual="/sinclude/common/weixin/weixin_dns_prefetch.shtml" -->

    <title>我的订单 - 麦大大管家</title>

    <!--#include virtual="/sinclude/common/weixin/weixin_oneapm_js.shtml" -->
    <!--#include virtual="/sinclude/common/weixin/weixin_common_css.shtml" -->
    <link href="http://www.maidada.cn/static/weixin/css/order.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="orderbox"></div>

    <div id="emptybox" class="wrap" style="display: none; text-align: center;">
        <img src="http://www.maidada.cn/static/weixin/img/order_empty.png" width="80px" style="display: inline-block;" />
        <p class="remind">您好，您目前还没有订单</p>
        <div class="no-guanjia">
            <a href="services.shtml" class="no-gj-box">
                <button type="button" class="no-gj-btn">去看看我们提供哪些服务</button>
            </a>
        </div>
    </div>

    <script id="template" type="x-tmpl-mustache">
        <a href="status.shtml?id={{id_str}}&type={{type}}">
            <div class="list shdow">
                <div class="list-title">
                    <span class="big-text">{{type_name}}</span>
                    {{#price}}（<span class="big-text">{{price}}</span>）{{/price}}
                    <span class="state">状态：
                        <span class="state-highlight">{{step_status}}</span>
                    </span>
                </div>
                <div class="list-content">
                    {{#take_car.time}}
                    <p>
                        <span class="p-one">取车时间</span>
                        <span class="p-two">{{take_car.time}}</span>
                    </p>
                    {{/take_car.time}}
                    {{#take_car.location.name}}
                    <p>
                        <span class="p-one">取车地点</span>
                        <span class="p-two">{{take_car.location.name}}</span>
                    </p>
                    {{/take_car.location.name}}
                    {{#advisor.name}}
                    <p>
                        <span class="p-one">服务管家</span>
                        <span class="p-two">{{advisor.name}}</span>
                    </p>
                    {{/advisor.name}}
                    {{#create_time}}
                    <p>
                        <span class="p-one">提交时间</span>
                        <span class="p-two">{{create_time}}</span>
                    </p>
                    {{/create_time}}
                    <p>
                        <span class="p-one">订单编号</span>
                        <span class="p-two">{{id_str}}</span>
                    </p>
                </div>
            </div>
        </a>
    </script>

    <!--#include virtual="/sinclude/common/weixin/weixin_common_js.shtml" -->
    <script type="text/javascript">
        $(function() {
            // 订单列表的回调函数
            var list_my_orders_callback = function(orders, status) {
                if (status === true) {
                    if (!orders || orders.length == 0) {
                        $("#emptybox").show();
                    }

                    var i, item;
                    for (i in orders) {
                        item = orders[i];
                        if (item.price == '' || item.price == '0' || item.price == '¥0') {
                            item.price = false;
                        }
                        if (item.take_car) {
                            if (item.take_car.time) {
                                item.take_car.time = moment.unix(item.take_car.time).format('MM-DD HH:mm');
                            }
                        }
                        if (item.create_time) {
                            item.create_time = moment.unix(item.create_time).format('MM-DD HH:mm');
                        }
                        $('.orderbox').append(Mustache.render($('#template').html(), item));
                    }
                } else {
                    layer.open({
                        content: MaiDaDa.getErrorMessage(),
                        btn: ['OK']
                    });
                    return false;
                }
            };

            // 未登录的用户需要登录
            if (MaiDaDa.isWeixinLogin()) {
                var uid = MaiDaDa.getTTYCUserID();
                if (uid) {
                    LogCol && window.LogCol.upLog();
                    // 订单列表
                    MaiDaDa.listMyOrders(list_my_orders_callback);
                } else {
                    MaiDaDa.redirectToBinding();
                    return false;
                }
            } else {
                // 登录
                MaiDaDa.login();
                return false;
            }
        });
    </script>
</body>

</html>
